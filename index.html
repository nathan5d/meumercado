<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Listas de Compras</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">

    <!-- Dentro da seção head -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="manifest" href="./manifest.json">

    <!-- Torna o aplicativo web executável em tela cheia no iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Define a cor da barra de status no Android -->
    <meta name="theme-color" content="#ffffff">

    <!-- Define a cor da barra de status no iOS -->
    <meta name="apple-mobile-web-app-status-bar" content="#ffffff" />
    <!-- Define o estilo da barra de status no iOS como "black-translucent" para um visual translúcido -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Título exibido quando o aplicativo é adicionado à tela inicial no iOS -->
    <meta name="apple-mobile-web-app-title" content="Meu Mercado">

    <!-- Ícone do aplicativo na tela inicial do iOS -->
    <link rel="apple-touch-icon" href="/assets/images/AppIcon.png">



    <link rel="stylesheet" href="./vendor/bulma/css/bulma.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">

    <script src="./vendor/jquery/dist/jquery.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.js"></script>


</head>

<body class="">
    <!-- Container principal -->
    <div class="container">


        <!-- Conteúdo do aplicativo -->
        <section class="full-content">
            <nav class="navbar" role="navigation" aria-label="main navigation">

                <div class="navbar-menu">
                    <!-- shown on mobile -->
                    <div class="navbar-item">

                        <p class="subtitle is-5">Minhas listas</p>
                    </div>

                    <div class="navbar-item">
                        <span class="icon is-large">
                            <button class="button icon right" onclick="toggleDarkMode()">
                                <ion-icon name="moon" class="darkModeToggle"></ion-icon>
                            </button>
                        </span>

                    </div>

                </div>

            </nav>



            <!-- Lista de listas com estilo iOS -->
            <div class="box-content-header">
                <span class="box-content-title">Listas de Compras</span>
            </div>
            <div class="box-content">
                <ul id="listas" class="menu-list">
                    <!-- Listas de compras serão adicionadas aqui -->
                </ul>
                <!-- Botão para limpar a lista com estilo iOS -->

            </div>

            <div class="box-content-header">
                <span class="box-content-title">Nova Lista</span>
            </div>
            <div class="box-content">
                <!-- Campos e botões com estilo iOS -->
                <div class="field">
                    <label class="label">Nome da Lista</label>
                    <div class="control">
                        <input class="input" type="text" id="nomeLista" placeholder="Nome da Lista">
                    </div>
                </div>
                <div class="field is-grouped">
                    <div class="control">
                        <button class="button is-primary" onclick="criarLista()">Criar Lista</button>
                    </div>
                </div>
            </div>





        </section>
        <!-- Container para campos de adicionar item (inicialmente oculto) -->
        <div id="camposAdicionarItem" class="full-content" style="display: none;">
            <nav class="navbar" role="navigation" aria-label="main navigation">

                <div class="navbar-menu">
                    <!-- shown on mobile -->
                    <div class="navbar-item">
                        <span class="icon toback is-large">
                            <button class="button icon left" onclick="ocultarLista()">
                                <ion-icon name="arrow-back-outline"></ion-icon>
                            </button>
                        </span>
                        <p class="subtitle is-5 nome-lista-atual" id="nomeListaAtual"></p>
                    </div>


                    <div class="navbar-item">
                        <span class="icon is-large">
                            <button class="button icon left" onclick="toggleDarkMode()">
                                <ion-icon name="moon" class="darkModeToggle"></ion-icon>
                            </button>
                        </span>
                        <button class="button header" onclick="removerListaAtual()">Remover Lista</button>
                    </div>
                </div>

            </nav>


            <!-- Lista de itens com estilo iOS -->

            <div class="box-content-header">
                <span class="box-content-title">Itens da Lista</span>
                <button class="btn-add show">+</button>
            </div>

            <div class="box-content">
                <ul id="lista">
                    <!-- Itens da lista serão adicionados aqui -->
                </ul>
            </div>

            <div class="box-content">
                <div class="total">
                    <div id="totaLista">Total: <b id="totalLista"></b></div>
                    <div class="foraCarrinho">Não marcados: <b id="totalForaCarrinho"></b></div>
                    <div class="carrinho">Marcados: <b id="totalCarrinho"></b></div>
                </div>

            </div>

            <div class="box-content">
                <div class="field is-grouped">
                    <div class="control">
                        <button class="button is-danger" onclick="limparLista()">Limpar Lista</button>
                    </div>
                </div>
            </div>

            <!-- Modal de Edição/Adição de Item -->
            <div class="box-content-modal" style="text-align: center;">
                <div class="close">
                    <icon>&times;</icon>
                </div>
                <div class="x-panel-mobile"></div>
                <p class="subtitle is-5 nome-lista-atual" id="nomeListaAtualModal"></p>
                <div class="content">
                    <!-- Campos e botões com estilo iOS para editar/adicionar itens -->
                    <div class="field">
                        <label class="label">Nome do Item</label>
                        <div class="control">
                            <input class="input" type="text" id="editItem" placeholder="Nome do Item">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Quantidade</label>
                        <div class="control">
                            <input class="input" type="number" id="editQuantidade" placeholder="Quantidade">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Preço</label>
                        <div class="control">
                            <input class="input" type="number" id="editPreco" placeholder="Preço">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Unidade</label>
                        <div class="control">
                            <input class="input" type="text" id="editUnidade" placeholder="Unidade">
                        </div>
                    </div>
                    <div class="field is-grouped">
                        <div class="control">
                            <button class="button is-primary" id="editarItemBtn" onclick="editarItem()">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="offline-message" class="offline-message">
            Você está offline. O conteúdo pode não estar atualizado.
        </div>

    </div>

    <script>
        // Função para mostrar/ocultar campos de adicionar item
        function mostrarCamposAdicionarItem() {
            const camposAdicionarItem = $("#camposAdicionarItem");
            camposAdicionarItem.toggle();
        }

        // Função para criar uma nova lista de compras
        function criarLista() {
            const nomeListaInput = $("#nomeLista");
            const nomeLista = nomeListaInput.val().trim();

            if (nomeLista !== "") {
                const lista = { items: [] }; // Crie uma nova lista vazia
                const listas = JSON.parse(localStorage.getItem("listas")) || [];

                if (!listas.includes(nomeLista)) {
                    listas.push(nomeLista);
                    localStorage.setItem("listas", JSON.stringify(listas));
                }

                localStorage.setItem(nomeLista, JSON.stringify(lista));
                nomeListaInput.val("");

                listarListas();
                mostrarLista(nomeLista);
            }
        }

        // Função para listar todas as listas disponíveis
        // Função para listar todas as listas disponíveis
        // Função para listar todas as listas disponíveis
        function listarListas() {
            // Obtém as listas do Local Storage ou cria uma lista vazia se não existir
            const listas = JSON.parse(localStorage.getItem("listas")) || [];

            // Seleciona o elemento <ul> com o ID "listas"
            const listasUl = $("#listas");

            // Limpa o conteúdo atual da lista antes de atualizá-lo
            listasUl.html("");

            // Itera sobre cada lista e cria um item de lista (<li>) para cada uma
            $.each(listas, function (index, lista) {
                const listItem = $("<li>");

                const listContainer = $("<div>").addClass("c-control")
                const listNome = $("<large>").addClass('subtitle').text(lista);

                listContainer.append(listNome);
                listItem.append(listContainer);

                // Adiciona um evento de clique ao item da lista para mostrar a lista
                listItem.click(function () {
                    mostrarLista(lista);
                });

                // Obtém a lista de itens para a lista atual
                let listaItens = JSON.parse(localStorage.getItem(lista));


                // Verifica se listaItens.items é um array; se não, cria um array vazio
                if (!Array.isArray(listaItens.items)) {
                    listaItens.items = [];
                }
                // Calcula a contagem de itens marcados, não marcados e o total
                const itensMarcados = listaItens.items.filter(item => item.selecionado).length;
                const itensNaoMarcados = listaItens.items.filter(item => !item.selecionado).length;
                const totalItens = listaItens.items.length;

                // Cria um elemento <span> para exibir as contagens
                // const contagemItens = $("<span>").text(`${itensMarcados}/${itensNaoMarcados} | Total: ${totalItens}`);
                const contagemItens = $("<span>").text(`${itensMarcados}/${totalItens}`);

                // Adiciona a contagem de itens ao item da lista
                listItem.append(contagemItens);

                // Adiciona o item da lista à lista não ordenada (<ul>)
                listasUl.append(listItem);
            });
        }

        // Chama a função inicialmente para listar as listas disponíveis
        //listarListas();



        function ocultarLista() {
            const camposAdicionarItem = $("#camposAdicionarItem");
            camposAdicionarItem.hide();
        }

        // Função para mostrar uma lista específica
        function mostrarLista(nomeLista) {
            const nomeListaAtual = $("#nomeListaAtual");
            nomeListaAtual.text(nomeLista);

            // Mostrar campos de adicionar item quando uma lista é selecionada
            const camposAdicionarItem = $("#camposAdicionarItem");
            camposAdicionarItem.show();

            let lista = JSON.parse(localStorage.getItem(nomeLista)) || { items: [] }; // Obtenha a lista do LocalStorage

            console.log
            const listaUl = $("#lista");
            listaUl.html("");

            let totalLista = 0; // Inicialize o total da lista
            let totalCarrinho = 0; // Inicialize o total do carrinho
            let totalForaDoCarrinho = 0;

            $.each(lista.items, function (index, item) {
                const controlContainer = $("<div>").addClass("c-control");
                const checkboxContainer = $("<div>");
                const checkboxLabel = $("<label>").addClass("subtitle").text(item.nome).attr({ for: "item" + index });
                const checkbox = $("<input>").attr({
                    type: "checkbox",
                    class: "item-checkbox",
                    id: "item" + index,
                    "data-index": index
                });

                // Adicione um identificador aos itens selecionados
                checkbox.attr("data-selecionado", item.selecionado);

                const checkmark = $("<span>").addClass("checkmark");
                checkboxLabel.append(checkbox, checkmark);
                //checkboxContainer.append(checkboxLabel);

                // Formatando os valores como monetários (Reais - BRL)
                const precoFormatado = item.preco.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                const totalItem = (item.quantidade * item.preco).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                checkboxContainer.append(checkboxLabel, `${item.quantidade} x, ${precoFormatado} ${item.unidade}, ${totalItem}`);
                //const listItem = $("<li>").append(checkboxContainer, `${item.quantidade} x, Preço: ${precoFormatado} ${item.unidade}, Total: ${totalItem}`);
                controlContainer.append(checkboxContainer);
                const listItem = $("<li>").append(controlContainer);

                listaUl.append(listItem);

                const editButton = $("<button>").text("Editar");
                editButton.click(function () {
                    iniciarEdicaoOuAdicao(index);
                });

                // listItem.append(editButton);
                controlContainer.append(editButton);
                // Adicionar eventos para marcar/desmarcar os itens
                checkbox.change(function () {
                    const isChecked = this.checked;
                    const dataIndex = $(this).data("index");

                    // Marcar/desmarcar o item no array de itens
                    lista.items[dataIndex].selecionado = isChecked;

                    // Atualizar o LocalStorage
                    localStorage.setItem(nomeLista, JSON.stringify(lista));
                    console.log(nomeLista, JSON.stringify(lista));

                    // Atualizar o total do carrinho e fora do carrinho
                    atualizaTotais(lista); // Passe a lista como argumento
                });

                // Calculando o total da lista
                totalLista += item.quantidade * item.preco;

                // Verificando se o item já está selecionado e marcando a caixa de seleção, se necessário
                if (item.selecionado) {
                    checkbox.prop("checked", true);
                    totalCarrinho += item.quantidade * item.preco;
                }
            });

            // Exibir os totais no final
            const totalListaFormatado = totalLista.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const totalCarrinhoFormatado = totalCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const totalForaCarrinhoFormatado = totalForaDoCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            $("#totalLista").text(totalListaFormatado);

            // Função para atualizar os totais
            function atualizaTotais(lista) { // Receba a lista como argumento
                // Recalcule os totais do carrinho e fora do carrinho
                totalCarrinho = 0;
                totalForaDoCarrinho = 0;
                $.each(lista.items, function (index, item) {
                    const totalItem = item.quantidade * item.preco;
                    if (item.selecionado) {
                        totalCarrinho += totalItem;
                    } else {
                        totalForaDoCarrinho += totalItem;
                    }
                });

                // Atualize os totais na página
                const totalCarrinhoFormatado = totalCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                const totalForaCarrinhoFormatado = totalForaDoCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                $("#totalCarrinho").text(totalCarrinhoFormatado);
                $("#totalForaCarrinho").text(totalForaCarrinhoFormatado);

                // Atualize o LocalStorage com a lista atualizada
                localStorage.setItem(nomeLista, JSON.stringify(lista));


            }

            // Chame a função para atualizar os totais
            atualizaTotais(lista); // Passe a lista como argumento
        }

        // Função para iniciar a edição ou adição de um item
        function iniciarEdicaoOuAdicao(indice) {
            const nomeListaAtual = $("#nomeListaAtual").text();
            const lista = JSON.parse(localStorage.getItem(nomeListaAtual)) || { items: [] };

            if (indice >= 0) { // Se o índice for fornecido, estamos editando um item existente
                // Preencha os campos de edição com os valores do item selecionado
                const itemEditado = lista.items[indice];
                $("#editItem").val(itemEditado.nome);
                $("#editQuantidade").val(itemEditado.quantidade);
                $("#editPreco").val(itemEditado.preco);
                $("#editUnidade").val(itemEditado.unidade);

                // Defina o índice do item sendo editado como um atributo de dados no botão "Salvar"
                $("#nomeListaAtualModal").text("Editando: " + itemEditado.nome);
                $("#editarItemBtn").data("indice", indice);
            } else { // Caso contrário, estamos adicionando um novo item
                // Limpe os campos de edição
                $("#editItem").val("");
                $("#editQuantidade").val("1");
                $("#editPreco").val("0");
                $("#editUnidade").val("Un");

                // Limpe o atributo de dados do botão "Salvar"
                $("#editarItemBtn").removeData("indice");

                // Defina o texto apropriado no modal
                $("#nomeListaAtualModal").text("Adicionar Novo Item");
            }

            // Abra o modal de edição/adicão
            //$(".box-content-modal").addClass("active");
            abrirModal();
        }
        // Função para editar um item
        // Função para editar ou adicionar um item
        function editarItem() {
            const nomeListaAtual = $("#nomeListaAtual").text();
            const editItemInput = $("#editItem");
            const editQuantidadeInput = $("#editQuantidade");
            const editPrecoInput = $("#editPreco");
            const editUnidadeInput = $("#editUnidade");

            const nomeItemEditado = editItemInput.val().trim();
            const quantidadeEditada = parseFloat(editQuantidadeInput.val());
            const precoEditado = parseFloat(editPrecoInput.val());
            const unidadeEditada = editUnidadeInput.val().trim();

            // Obtenha o índice do item sendo editado (se existir)
            const indiceDoItemEditado = $("#editarItemBtn").data("indice");

            // Obtenha a lista do LocalStorage
            const lista = JSON.parse(localStorage.getItem(nomeListaAtual)) || { items: [] };

            if (indiceDoItemEditado !== undefined && indiceDoItemEditado >= 0) { // Se estamos editando um item existente
                // Atualize os valores do item com os valores dos campos de edição
                lista.items[indiceDoItemEditado].nome = nomeItemEditado;
                lista.items[indiceDoItemEditado].quantidade = quantidadeEditada;
                lista.items[indiceDoItemEditado].preco = precoEditado;
                lista.items[indiceDoItemEditado].unidade = unidadeEditada;
            } else { // Caso contrário, estamos adicionando um novo item
                const item = {
                    nome: nomeItemEditado,
                    quantidade: quantidadeEditada,
                    preco: precoEditado,
                    unidade: unidadeEditada,
                    selecionado: false
                };
                lista.items.push(item);
            }

            // Atualize o LocalStorage com a lista atualizada
            localStorage.setItem(nomeListaAtual, JSON.stringify(lista));

            // Recarregue a lista e exiba-a novamente
            atualizarLista();

            // Feche o modal de edição/adicão
            $("#nomeListaAtualModal").text(""); // Limpe o texto do modal
            //$(".box-content-modal").removeClass("active"); // Feche o modal
            fecharModal();
        }
        // Função para remover a lista atual
        function removerListaAtual() {
            const nomeListaAtual = $("#nomeListaAtual").text();
            if (confirm(`Tem certeza de que deseja remover a lista "${nomeListaAtual}"?`)) {
                // Remover a lista do LocalStorage
                const listas = JSON.parse(localStorage.getItem("listas")) || [];
                const index = listas.indexOf(nomeListaAtual);
                if (index > -1) {
                    listas.splice(index, 1);
                    localStorage.setItem("listas", JSON.stringify(listas));
                }

                // Remover a lista atual do LocalStorage
                localStorage.removeItem(nomeListaAtual);

                // Limpar a lista na página
                atualizarLista();

                // Limpar o nome da lista atual
                $("#nomeListaAtual").text("");
            }
        }

        // Função para limpar a lista atual
        function limparLista() {
            const nomeListaAtual = $("#nomeListaAtual").text();
            if (confirm(`Tem certeza de que deseja limpar a lista "${nomeListaAtual}"?`)) {
                const lista = { items: [] };
                localStorage.setItem(nomeListaAtual, JSON.stringify(lista));
                atualizarLista();
            }
        }

        // Função para atualizar a lista na página
        // Função para atualizar a lista na página
        function atualizarLista() {
            const nomeListaAtual = $("#nomeListaAtual");
            const lista = JSON.parse(localStorage.getItem(nomeListaAtual.text())) || { items: [] };
            const listaUl = $("#lista");
            listaUl.html("");

            let totalLista = 0;
            let totalCarrinho = 0;
            let totalForaDoCarrinho = 0;

            $.each(lista.items, function (index, item) {
                const controlContainer = $("<div>").addClass("c-control");
                const checkboxContainer = $("<div>");
                const checkboxLabel = $("<label>").addClass("").text(item.nome).attr({ for: "item" + index });
                const checkbox = $("<input>").attr({
                    type: "checkbox",
                    class: "item-checkbox",
                    id: "item" + index,
                    "data-index": index
                });


                // Adicione um identificador aos itens selecionados
                checkbox.attr("data-selecionado", item.selecionado);

                const checkmark = $("<span>").addClass("checkmark");
                checkboxLabel.append(checkbox, checkmark);
                //checkboxContainer.append(checkboxLabel);

                // Formatando os valores como monetários (Reais - BRL)
                const precoFormatado = item.preco.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                const totalItem = (item.quantidade * item.preco).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                checkboxContainer.append(checkboxLabel, `${item.quantidade} x, ${precoFormatado} ${item.unidade}, ${totalItem}`);
                //const listItem = $("<li>").append(checkboxContainer, `${item.quantidade} x, Preço: ${precoFormatado} ${item.unidade}, Total: ${totalItem}`);
                controlContainer.append(checkboxContainer);
                const listItem = $("<li>").append(controlContainer);

                listaUl.append(listItem);

                const editButton = $("<button>").text("Editar");
                editButton.click(function () {
                    iniciarEdicaoOuAdicao(index);
                });

                // listItem.append(editButton);
                controlContainer.append(editButton);

                // Função para atualizar os totais
                function atualizaTotais(lista) { // Receba a lista como argumento
                    // Recalcule os totais do carrinho e fora do carrinho
                    totalCarrinho = 0;
                    totalForaDoCarrinho = 0;
                    $.each(lista.items, function (index, item) {
                        const totalItem = item.quantidade * item.preco;
                        if (item.selecionado) {
                            totalCarrinho += totalItem;
                        } else {
                            totalForaDoCarrinho += totalItem;
                        }
                    });

                    // Atualize os totais na página
                    const totalCarrinhoFormatado = totalCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                    const totalForaCarrinhoFormatado = totalForaDoCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                    $("#totalCarrinho").text(totalCarrinhoFormatado);
                    $("#totalForaCarrinho").text(totalForaCarrinhoFormatado);

                    // Atualize o LocalStorage com a lista atualizada
                    localStorage.setItem(nomeLista, JSON.stringify(lista));


                }

                // Adicionar eventos para marcar/desmarcar os itens
                checkbox.change(function () {
                    const isChecked = this.checked;
                    const dataIndex = $(this).data("index");

                    // Marcar/desmarcar o item no array de itens
                    lista.items[dataIndex].selecionado = isChecked;

                    // Atualizar o LocalStorage
                    localStorage.setItem(nomeListaAtual.text(), JSON.stringify(lista));

                    // Atualizar o total do carrinho e fora do carrinho
                    atualizaTotais(lista); // Passe a lista como argumento
                });

                // Calculando o total da lista
                totalLista += item.quantidade * item.preco;

                // Verificando se o item já está selecionado e marcando a caixa de seleção, se necessário
                if (item.selecionado) {
                    checkbox.prop("checked", true);
                    totalCarrinho += item.quantidade * item.preco;
                }
            });

            // Exibir totais
            const totalListaFormatado = totalLista.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const totalCarrinhoFormatado = totalCarrinho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const totalForaCarrinhoFormatado = (totalLista - totalCarrinho).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
            });

            $("#totalLista").text(totalListaFormatado);
            $("#totalCarrinho").text(totalCarrinhoFormatado);
            $("#totalForaCarrinho").text(totalForaCarrinhoFormatado);
        }

        function abrirModal() {
            $(".box-content-modal").addClass("active");

            // Oculte o botão "btn-add" com a classe "hidden" e remova a classe "show" se estiver presente
            $(".btn-add").addClass("hidden").removeClass("show");
        }

        function fecharModal() {
            $(".box-content-modal").removeClass("active");

            // Remova a classe "hidden" e adicione a classe "show" para mostrar o botão "btn-add"
            $(".btn-add").removeClass("hidden").addClass("show");
        }


        // Função para aplicar o modo escuro ou claro
        function applyDarkMode(isDarkMode) {
            const body = $('body');

            // Obtenha a cor de fundo atual
            const backgroundColor = body.css('background-color');

            // Atualize a cor da barra de status
            $('meta[name="theme-color"]').attr('content', isDarkMode ? '#333333' : backgroundColor);

            // Atualize a cor do tema
            $('meta[name="apple-mobile-web-app-status-bar-style"]').attr('content', isDarkMode ? 'default' : 'black-translucent');

            // Atualize o ícone do modo claro/escuro
            const darkModeToggle = $('.darkModeToggle');
            if (isDarkMode) {
                darkModeToggle.attr('name', 'sunny');
            } else {
                darkModeToggle.attr('name', 'moon');
            }

            // Aplicar classe dark-mode ao body se o modo escuro estiver ativado
            if (isDarkMode) {
                body.addClass('dark-mode');
            } else {
                body.removeClass('dark-mode');
            }

            // Armazene a preferência do usuário no Local Storage
            localStorage.setItem('darkMode', isDarkMode);
        }


        // Função para alternar o modo claro/escuro
        function toggleDarkMode() {


            const body = $('body');
            const isDarkMode = body.toggleClass('dark-mode').hasClass('dark-mode');
            applyDarkMode(isDarkMode);

            // Atualize o ícone do modo claro/escuro
            const darkModeToggle = $('.darkModeToggle');
            if (isDarkMode) {
                darkModeToggle.attr('name', 'sunny');
            } else {
                darkModeToggle.attr('name', 'moon');
            }

            // Armazene a preferência do usuário no Local Storage
            localStorage.setItem('darkMode', isDarkMode);
        }


        // Carregar a lista de listas quando a página é carregada
        $(document).ready(function () {
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'true') {
                // Se o modo escuro estiver salvo, aplique-o
                applyDarkMode(true);
            }

            listarListas();
            $('.box-content-modal .x-panel-mobile,.close').on('click', function () {
                fecharModal();
            })
            $('.btn-add').on('click', function () {
                iniciarEdicaoOuAdicao();
            })


            const offlineMessage = $("#offline-message");
            const pageContent = $(".full-content");
            console.log('teste', navigator.onLine);
            if (navigator.onLine) {
                offlineMessage.css("display", "none");
            } else {
                offlineMessage.css("display", "block");
                pageContent.css("padding-bottom", "30px");
            }

            //offlineMessage.style.display = navigator.onLine ? "none" : "block";

        });

    </script>

    <script>
        /* Verificar status da conexão e exibir mensagem offline ao carregar a página
        document.addEventListener("DOMContentLoaded", () => {
           const offlineMessage = document.getElementById("offline-message");
           console.log(navigator.onLine);
           offlineMessage.style.display = navigator.onLine ? "none" : "block";


       });*/
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/meumercado/service-worker.js')
                .then(function (registration) {
                    console.log('Service Worker registrado com sucesso:', registration);
                })
                .catch(function (error) {
                    console.log('Erro ao registrar o Service Worker:', error);
                });
        }
    </script>

</body>

</html>